# Operations Summary

This doc outlines day-2 operations, with a focus on realtime hardening and incident response.

## Realtime (WS/SSE) Hardening

Goal: move from mock WebSocket to a robust production-ready realtime transport with safe fallbacks.

### Health checks

- Server heartbeat endpoint (e.g., GET /healthz) should include a check for the WS/SSE broker.
- Client pings or server heartbeats (ping/pong) to detect stale connections.

### Backoff, timeouts, and limits

- Use exponential backoff (with jitter) for reconnects.
- Enforce message size/time limits. Abort streams on inactivity.
- Guard against reconnect storms with a circuit breaker window.

### Fallbacks

- Primary: WebSocket
- Fallback 1: SSE (server-sent events)
- Fallback 2: Polling (short-lived, cache-aware)

Pseudocode outline:

```ts path=null start=null
async function connectRealtime() {
  try {
    return await connectWebSocket({ timeoutMs: 5000 });
  } catch (e) {
    try {
      return await connectSSE({ timeoutMs: 5000 });
    } catch (e2) {
      return startPolling({ intervalMs: 3000 });
    }
  }
}
```

### Observability

- Metrics: connection attempts, success rate, reconnect count, time-to-first-message.
- Logs: handshake failures, auth errors, disconnect reasons.
- Traces: annotate spans with transport (WS/SSE/polling) and retry counts.

### Configuration

- Server keepalive interval, idle timeouts, and max concurrent connections per user/IP.
- Client-side maximum reconnect time window.
- Feature flag for toggling transport preference.

## Runbook (incidents)

1. Identify scope: specific route, region, or all users.
2. Check dashboards: rate of 5xx, WS connects, timeouts.
3. Validate health endpoints and broker status.
4. Attempt transport downgrade (WS→SSE→polling) if degraded.
5. Communicate status, including expected timelines.
6. Rollback if a recent release correlates with the spike.
7. Create a post-incident follow-up (root cause, mitigations, tests).

## Routine ops

- Audit logs and SLOs weekly; capture trends and flapping alerts.
- Rotate keys/secrets per policy; verify secret mount at runtime.
- Budget alerts for provider APIs with hard quotas.
- Refresh test data and check MSW mock parity with prod behaviors.
