import { Meta, Canvas, Story, Source } from "@storybook/addon-docs/blocks";

export const parameters = {
  repoDocPath: "/docs/api/REST_API.md",
  repoDocLabel: "REST API Overview",
};

<Meta title="Docs/Debug API" />

## Endpoints

- GET /api/debug/endpoints
- GET /api/debug/logs
- POST /api/debug/logs

## Try it

<Canvas>
  <Story name="List Endpoints">
    {() => (
      <div style={{ display: "grid", gap: 12 }}>
        <button
          data-testid="btn-endpoints"
          onClick={async () => {
            const res = await fetch("/api/debug/endpoints");
            const json = await res.json();
            const pre = document.querySelector("[data-testid=out-endpoints]");
            pre.textContent = JSON.stringify(json, null, 2);
          }}
        >
          Load Endpoints
        </button>
        <pre
          data-testid="out-endpoints"
          style={{
            maxHeight: 300,
            overflow: "auto",
            background: "#111",
            color: "#0f0",
            padding: 12,
          }}
        />
      </div>
    )}
  </Story>
</Canvas>

<Canvas>
  <Story name="Logs">
    {() => (
      <div style={{ display: "grid", gap: 12 }}>
        <div style={{ display: "flex", gap: 8 }}>
          <input data-testid="log-message" defaultValue="hello from story" />
          <button
            onClick={async () => {
              const input = document.querySelector("[data-testid=log-message]")?.value || "hello";
              await fetch("/api/debug/logs", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  level: "info",
                  message: input,
                  meta: { source: "storybook" },
                }),
              });
              const res = await fetch("/api/debug/logs");
              const json = await res.json();
              const pre = document.querySelector("[data-testid=out-logs]");
              pre.textContent = JSON.stringify(json, null, 2);
            }}
          >
            Append & Refresh
          </button>
        </div>
        <pre
          data-testid="out-logs"
          style={{
            maxHeight: 300,
            overflow: "auto",
            background: "#111",
            color: "#0f0",
            padding: 12,
          }}
        />
      </div>
    )}
  </Story>
</Canvas>
