import { Meta } from "@storybook/addon-docs/blocks";
import InlineToc from "../components/InlineToc";
import LastUpdated from "../components/LastUpdated";

# Journeys — TDD & MSW

<Meta title="Journeys/TDD & MSW" />

A short playbook for combining user journeys with TDD and mock‑first development using MSW.

<InlineToc
  items={[
    { href: "#cycle", label: "TDD cycle" },
    { href: "#smokes", label: "@smoke subset" },
    { href: "#msw", label: "MSW setup" },
    { href: "#coverage", label: "Coverage & gates" },
  ]}
/>

## TDD cycle {#cycle}

1) Define acceptance via a small journey (mock‑backed) in Docs/User Journeys
2) Add/adjust a failing unit test (e.g., src/lib/ai/__tests__/service.test.ts)
3) Implement logic minimally; keep providers mocked unless you’re validating a real path
4) Make the journey pass; then stabilize selectors and timing
5) Refactor; keep the suite green

## @smoke subset {#smokes}

- Keep a fast, deterministic set of happy‑path flows tagged @smoke
- Run them locally and in CI gates as a minimal bar
- Use Labs/E2E Smoke Lab for commands, selectors, and MSW guidance

## MSW setup {#msw}

- Storybook and dev server both use MSW for consistent mocks
- Handlers live under src/mocks/handlers/** and support triggers like TRIGGER_RATE_LIMIT
- Dev flag NEXT_PUBLIC_ENABLE_MSW=1 enables the worker in the app; Storybook initializes its own

## Coverage & gates {#coverage}

- Unit + API route tests lift core coverage; E2E smokes ensure golden flows don’t regress
- Keep your thresholds realistic and scoped to core code as you build out tests

<LastUpdated file="src/stories/Journeys/TDD-MSW.docs.mdx" />

